---
layout: post
title:  "Reactor ì‹¤ì „ íŒ¨í„´"
date:   2025-07-27 20:23:00 +0900
categories: dev
---

## Reactor ì‹¤ì „ íŒ¨í„´

ì‹¤ë¬´í•˜ë‹¤ê°€ í—·ê¹”ë¦¬ëŠ” íŒ¨í„´ë“¤ì„ ì •ì˜í•¨


### 1) `Flux<List<String>>` â†’ **Mono\<List<String>>** (flatten)

```java
Flux<List<String>> flux = Flux.just(
    List.of("A","B"),
    List.of("C"),
    List.of("D","E")
);

flux.reduce(new ArrayList<String>(), (acc, list) -> {
    acc.addAll(list);
    return acc;
}).subscribe(result -> System.out.println("reduce: " + result));
```

* `reduce()`ë¥¼ ì‚¬ìš©í•˜ì—¬ **ë¦¬ìŠ¤íŠ¸ë¥¼ í‰íƒ„í™”(Flatten)**
* ì—¬ëŸ¬ `List<String>`ì„ í•˜ë‚˜ì˜ `List<String>`ìœ¼ë¡œ í•©ì¹¨

**ê²°ê³¼**

```
reduce: [A, B, C, D, E]
```

---

### 2) `Flux<List<List<String>>>` â†’ **Flux<String>** (2ë‹¨ê³„ flatten)

```java
Flux<List<List<String>>> flux2 = Flux.just(
    List.of(List.of("A","B"), List.of("C")),
    List.of(List.of("D","E"), List.of("F"))
);

flux2.flatMapIterable(innerLists -> innerLists)
     .flatMapIterable(list -> list)
     .subscribe(System.out::println);
```

* **2ì¤‘ ë¦¬ìŠ¤íŠ¸ë¥¼ 2ë‹¨ê³„ë¡œ í’€ì–´ì„œ ê°œë³„ Stringê¹Œì§€ í‰íƒ„í™”**
* `[[A,B],[C]] â†’ [A,B,C]`

**ê²°ê³¼**

```
A
B
C
D
E
F
```

---

`Flux â†’ Mono â†’ Flux`ë¡œ ì™•ë³µí•˜ëŠ” ì˜ˆì œ

```java
Flux<String> flux = Flux.just("A","B","C");

Mono<List<String>> monoList = flux.collectList();         // Flux â†’ Mono<List<String>>
Flux<String> backToFlux = monoList.flatMapMany(Flux::fromIterable); // Mono<List<String>> â†’ Flux<String>

backToFlux.subscribe(System.out::println);
```

**ê²°ê³¼**

```
A
B
C
```

ğŸ‘‰ **ì¤‘ê°„ì— í•œ ë²ˆ `List`ë¡œ ë¬¶ì—ˆë‹¤ê°€ ë‹¤ì‹œ í’€ ë•Œ ìœ ìš©**

* ì˜ˆ: Fluxë¥¼ ì¼ë‹¨ ëª¨ì•„ì„œ ì •ë ¬/í•„í„° í›„ ë‹¤ì‹œ Fluxë¡œ í˜ë ¤ì•¼ í•  ë•Œ

---

`Flux<List<String>> â†’ Mono<List<String>> â†’ Flux<String>`

```java
Flux<List<String>> fluxOfLists = Flux.just(
    List.of("A","B"),
    List.of("C"),
    List.of("D","E")
);

Mono<List<String>> monoList = fluxOfLists
    .flatMapIterable(list -> list)   // flatten
    .collectList();                  // Mono<List<String>>

Flux<String> processedFlux = monoList
    .map(list -> list.stream().map(v -> v + "!").toList()) // ê°€ê³µ
    .flatMapMany(Flux::fromIterable); // ë‹¤ì‹œ Fluxë¡œ

processedFlux.subscribe(System.out::println);
```

**ê²°ê³¼**

```
A!
B!
C!
D!
E!
```

ğŸ‘‰ **Flux\<List<T>> â†’ í‰íƒ„í™” í›„ ê°€ê³µ â†’ ë‹¤ì‹œ Fluxë¡œ í˜ë¦¬ëŠ” íŒ¨í„´**

---

`Mono<List<String>> â†’ Flux<String> â†’ Mono<List<String>>`

```java
Mono<List<String>> monoList = Mono.just(List.of("A","B","C"));

Mono<List<String>> result = monoList
    .flatMapMany(Flux::fromIterable) // í¼ì¹˜ê¸°
    .map(v -> v + "!")
    .collectList();                   // ë‹¤ì‹œ ëª¨ìœ¼ê¸°

result.subscribe(System.out::println);
```

**ê²°ê³¼**

```
[A!, B!, C!]
```

ğŸ‘‰ **Mono ì•ˆì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ í¼ì³ì„œ ê°€ê³µ í›„ ë‹¤ì‹œ ë¬¶ëŠ” íŒ¨í„´**

---


`Mono<List<String>> â†’ Flux<List<String>> â†’ Mono<List<String>>`

```java
Mono<List<String>> monoList = Mono.just(List.of("A","B","C"));

Mono<List<String>> result = monoList
    .flatMapMany(list -> Flux.just(list)) // Flux<List<String>>
    .reduce(new ArrayList<>(), (acc, subList) -> { 
        acc.addAll(subList);
        return acc;
    });

result.subscribe(System.out::println);
```

**ê²°ê³¼**

```
[A, B, C]
```

ğŸ‘‰ **ì²­í¬ë¡œ ìª¼ê°¤ ìˆ˜ë„ ìˆì§€ë§Œ, ì—¬ê¸°ì„  ê·¸ëŒ€ë¡œ ë¦¬ìŠ¤íŠ¸ í•œë²ˆ ê±°ì³¤ë‹¤ê°€ ë‹¤ì‹œ í•©ì¹œ í˜•íƒœ**

---

`Flux<List<String>>` + `Mono<List<Integer>>` **zipWith** ì¡°í•©

```java
Flux<List<String>> fluxList = Flux.just(
    List.of("A","B"),
    List.of("C"),
    List.of("D","E")
);

Mono<List<Integer>> monoInts = Mono.just(List.of(1,2,3,4,5));

// zipWith + repeat â†’ Flux ì „ì²´ ë§¤ì¹­
Flux<String> zippedFlux = fluxList
    .zipWith(monoInts.repeat()) 
    .map(tuple -> tuple.getT1() + "::" + tuple.getT2());
```

**ê²°ê³¼**

```
[A, B]::[1, 2, 3, 4, 5]
[C]::[1, 2, 3, 4, 5]
[D, E]::[1, 2, 3, 4, 5]
```

---

ì¶”ê°€ì ìœ¼ë¡œ **flatten â†’ ë§¤ì¹­** í›„ ë‹¤ì‹œ Mono<List>ë¡œ ëª¨ìœ¼ê¸°:

```java
Mono<List<String>> combinedMono = fluxList
    .zipWith(monoInts.repeat())
    .flatMap(tuple -> Flux.fromIterable(tuple.getT1())
        .zipWithIterable(tuple.getT2())
        .map(pair -> pair.getT1() + "-" + pair.getT2())
    )
    .collectList(); // Mono<List<String>>
```

**ê²°ê³¼**

```
ìµœì¢… ê²°ê³¼: [A-1, B-2, C-1, D-1, E-2]
```

---

**Monoë¥¼ ë§¤ë²ˆ ìƒˆë¡­ê²Œ í˜¸ì¶œí•˜ê³  ì‹¶ì„ ë•Œ**

```java
Flux.just("A","B","C")
    .flatMap(v -> Mono.defer(() -> {
        System.out.println("API call: " + v);
        return Mono.just(v + "-result");
    }))
    .subscribe(System.out::println);
```

**ê²°ê³¼**

```
API call: A
A-result
API call: B
B-result
API call: C
C-result
```

---

`Flux<String>` + `Mono<String>` **zipWith** ë™ì‘ ì°¨ì´

```java
Flux<String> flux = Flux.just("A","B","C");
Mono<String> mono = Mono.just("X");

flux.zipWith(mono)          // ì²« ìš”ì†Œë§Œ ë§¤ì¹­
    .subscribe(t -> System.out.println(t.getT1() + "-" + t.getT2()));

flux.zipWith(mono.repeat()) // repeat â†’ Flux ì „ì²´ ë§¤ì¹­
    .subscribe(t -> System.out.println(t.getT1() + "-" + t.getT2()));
```

**ê²°ê³¼**

```
A-X        (monoëŠ” í•œ ë²ˆë§Œ emit â†’ ì²« ë²ˆì§¸ë§Œ ë§¤ì¹­)
A-X
B-X
C-X        (repeat() í•˜ë©´ ê°’ ì¬ë°©ì¶œ)
```

ğŸ‘‰ **MonoëŠ” 1íšŒ emitì´ë¼ zipí•˜ë©´ Flux ì²« ìš”ì†Œë§Œ ë§¤ì¹­ë¨ â†’ Flux ì „ì²´ ë§¤ì¹­í•˜ë ¤ë©´ repeat() í•„ìš”**

---

## âœ… í•µì‹¬ íŒ¨í„´

| ìƒí™©                                                  | ì£¼ìš” ì—°ì‚°                                             |
| --------------------------------------------------- | ------------------------------------------------- |
| `Flux<List<T>>` â†’ `Mono<List<T>>`                   | `reduce()` or `flatMapIterable + collectList()`   |
| `Flux<T>` â†’ `Mono<List<T>>` â†’ `Flux<T>`             | `collectList()` + `flatMapMany()`                 |
| `Mono<List<T>>` â†’ `Flux<T>` â†’ `Mono<List<T>>`       | `flatMapMany()` + `collectList()`                 |
| `Mono<List<T>>` â†’ `Flux<List<T>>` â†’ `Mono<List<T>>` | `flatMapMany(list -> Flux.just(list)) + reduce()` |
| `Flux` + `Mono` zip                                 | `zipWith(mono.repeat())`                          |
| Monoë¥¼ ë§¤ë²ˆ ìƒˆ í˜¸ì¶œ                                       | `Mono.defer()`                                    |
